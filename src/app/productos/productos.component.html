<div class="container my-4">
	<div class="row justify-content-center">
		<div class="col-12 col-lg-10">
			<div class="card shadow-sm">
				<div class="card-body">
					<div class="d-flex justify-content-between align-items-center mb-3">
						<h4 class="card-title mb-0">Gestión de Productos</h4>
					</div>

					<form #f="ngForm" (ngSubmit)="save(f)" class="row g-3">
						<div class="col-md-6">
							<label for="codigo" class="form-label">Código</label>
							<input id="codigo" name="codigo" required type="text" class="form-control" [(ngModel)]="modelo.codigo" pattern="^[A-Za-z]\d+$" #codigoModel="ngModel" [readonly]="editingCodigo">
							<small class="text-danger" *ngIf="codigoModel.invalid && (codigoModel.dirty || codigoModel.touched)">
								<span *ngIf="codigoModel.errors?.['required']">El código es requerido.</span>
								<span *ngIf="codigoModel.errors?.['pattern']">Código inválido. Debe iniciar con una letra seguida de números (ej: A001).</span>
							</small>
						</div>

						<div class="col-md-6">
							<label for="nombre" class="form-label">Nombre</label>
							<input id="nombre" name="nombre" required type="text" minlength="5" class="form-control" [(ngModel)]="modelo.nombre" #nombreModel="ngModel">
							<small class="text-danger" *ngIf="nombreModel.invalid && (nombreModel.dirty || nombreModel.touched)">
								<span *ngIf="nombreModel.errors?.['required']">El nombre es requerido.</span>
								<span *ngIf="nombreModel.errors?.['minlength']">El nombre del producto debe tener mínimo 5 caracteres.</span>
							</small>
						</div>

						<div class="col-md-4">
							<label for="costo" class="form-label">Costo</label>
							<input id="costo" name="costo" required type="number" step="0.01" min="0.01" class="form-control" [(ngModel)]="modelo.costo" #costoModel="ngModel">
							<small class="text-danger" *ngIf="costoModel.invalid && (costoModel.dirty || costoModel.touched)">
								<span *ngIf="costoModel.errors?.['required']">El costo es requerido.</span>
								<span *ngIf="costoModel.errors?.['min']">Ingrese un costo válido.</span>
							</small>
						</div>

						<div class="col-md-4">
							<label for="precio" class="form-label">Precio</label>
							<input id="precio" name="precio" required type="number" step="0.01" min="10" max="100" class="form-control" [(ngModel)]="modelo.precio" #precioModel="ngModel">
							<small class="text-danger" *ngIf="precioModel.invalid && (precioModel.dirty || precioModel.touched)">
								<span *ngIf="precioModel.errors?.['required']">El precio es requerido.</span>
								<span *ngIf="precioModel.errors?.['min'] || precioModel.errors?.['max']">El precio está fuera de rango.</span>
							</small>
						</div>

						<div class="col-md-4">
							<label for="valor" class="form-label">Valor</label>
							<input id="valor" name="valor" required type="number" step="0.01" class="form-control" [(ngModel)]="modelo.valor" #valorModel="ngModel">
							<small class="text-danger" *ngIf="valorModel.invalid && (valorModel.dirty || valorModel.touched)">
								<span *ngIf="valorModel.errors?.['required']">El valor es requerido.</span>
							</small>
						</div>

						<div class="col-12 d-flex gap-2 mt-2">
							<button type="submit" class="btn btn-primary" [disabled]="f.invalid">Guardar</button>
							<button type="button" class="btn btn-secondary" (click)="resetForm(f)">Cancelar</button>
						</div>
					</form>

					<hr class="my-4">

					<h5 class="mb-3">Lista de productos</h5>
					<div class="table-responsive">
						<table class="table table-striped table-hover align-middle">
							<thead class="table-light">
								<tr>
									<th>Código</th>
									<th>Nombre</th>
									<th>Costo</th>
									<th>Precio</th>
									<th>Valor</th>
									<th class="text-end">Acciones</th>
								</tr>
							</thead>
							<tbody>
								<tr *ngFor="let p of productos">
									<td>{{ p.codigo }}</td>
									<td>{{ p.nombre }}</td>
									<td>{{ p.costo | number:'1.2-2' }}</td>
									<td>{{ p.precio | number:'1.2-2' }}</td>
									<td>{{ p.valor | number:'1.2-2' }}</td>
									<td class="text-end">
										<button class="btn btn-sm btn-outline-primary me-1" (click)="edit(p)">Editar</button>
										<button class="btn btn-sm btn-outline-danger" (click)="remove(p)">Eliminar</button>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
